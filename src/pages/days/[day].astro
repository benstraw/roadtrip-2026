---
import Base from '../../layouts/Base.astro';
import DayNav from '../../components/DayNav.astro';
import Gallery from '../../components/Gallery.astro';
import { days } from '../../data/days';
import fs from 'node:fs';

export function getStaticPaths() {
  return days.map(d => ({
    params: { day: d.slug },
    props: { day: d },
  }));
}

const { day } = Astro.props;
const { theme } = day;
const prevDay = days.find(d => d.day === day.day - 1);
const nextDay = days.find(d => d.day === day.day + 1);

const mapExts = ['jpg', 'jpeg', 'webp', 'png'];
const mapExt = mapExts.find(ext =>
  fs.existsSync(`${process.cwd()}/public/images/days/${day.day}/map.${ext}`)
);
const heroPhoto = mapExt ? `/images/days/${day.day}/map.${mapExt}` : null;
---

<Base
  title={`Day ${day.day} â€” ${day.from} to ${day.to}`}
  description={`Day ${day.day}: ${day.tagline}`}
  theme={theme}
  ogImage={`/og/day-${day.day}.png`}
>
{day.gpxUrl && <link slot="head" rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />}

<style define:vars={{
  heroGrad: theme.heroGrad,
  accent: theme.accent,
  accentSoft: theme.accentSoft,
  bg: theme.bg,
  bgDeep: theme.bgDeep,
  surface: theme.surface,
  text: theme.text,
  textMuted: theme.textMuted,
  border: theme.border,
}}>
  /* â”€â”€â”€ PAGE SETUP â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  :root {
    --bg: var(--bg);
    --bg-deep: var(--bgDeep);
    --surface: var(--surface);
    --accent: var(--accent);
    --accent-soft: var(--accentSoft);
    --text: var(--text);
    --text-muted: var(--textMuted);
    --border: var(--border);
  }

  body {
    background: var(--bg);
    color: var(--text);
    padding-bottom: calc(var(--nav-height, 88px) + 40px);
  }

  /* â”€â”€â”€ HERO â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .day-hero {
    position: relative;
    min-height: min(60vh, 520px);
    display: flex;
    flex-direction: column;
    justify-content: flex-end;
    overflow: hidden;
  }

  .hero-bg-grad {
    position: absolute;
    inset: 0;
    background: var(--heroGrad);
  }

  /* Grid/texture overlay */
  .hero-texture {
    position: absolute;
    inset: 0;
    background-image:
      linear-gradient(rgba(255,255,255,0.025) 1px, transparent 1px),
      linear-gradient(90deg, rgba(255,255,255,0.025) 1px, transparent 1px);
    background-size: 40px 40px;
    mix-blend-mode: overlay;
  }

  /* The map photo slot */
  .hero-photo {
    position: absolute;
    inset: 0;
    z-index: 1;
  }

  .hero-photo img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    object-position: center;
    opacity: 0.7;
    mix-blend-mode: luminosity;
  }

  /* Image fails â†’ .no-photo class added via onerror */
  .hero-photo img { display: block; }
  .hero-photo.no-photo img { display: none; }

  /* Placeholder: always behind the image, shows through when img hides */
  .hero-photo-placeholder {
    position: absolute;
    inset: 0;
    z-index: 1;
    display: flex;
    align-items: center;
    justify-content: center;
    flex-direction: column;
    gap: 0.75rem;
    color: rgba(255,255,255,0.12);
  }

  .placeholder-icon {
    width: 80px;
    height: 80px;
    opacity: 0.15;
  }

  .placeholder-text {
    font-family: 'Caveat', cursive;
    font-size: 1rem;
    opacity: 0.3;
    letter-spacing: 0.05em;
  }

  /* Gradient scrim at bottom for text legibility */
  .hero-scrim {
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    height: 75%;
    background: linear-gradient(to top, var(--bg) 0%, rgba(0,0,0,0.3) 60%, transparent 100%);
    z-index: 2;
  }

  .hero-content {
    position: relative;
    z-index: 3;
    padding: clamp(1.5rem, 5vw, 3rem) clamp(1.25rem, 5vw, 3rem) 2rem;
  }

  /* Back to index */
  .back-link {
    display: inline-flex;
    align-items: center;
    gap: 0.4rem;
    font-family: 'Space Mono', monospace;
    font-size: 0.65rem;
    letter-spacing: 0.15em;
    text-transform: uppercase;
    color: var(--accent);
    opacity: 0.7;
    margin-bottom: 1.5rem;
    transition: opacity 0.2s;
  }
  .back-link:hover { opacity: 1; }
  .back-link svg { width: 14px; height: 14px; }

  .hero-meta {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    margin-bottom: 0.6rem;
    flex-wrap: wrap;
  }

  .meta-day {
    font-family: 'Space Mono', monospace;
    font-size: 0.7rem;
    letter-spacing: 0.15em;
    text-transform: uppercase;
    color: var(--accent);
    padding: 0.25em 0.65em;
    border: 1px solid var(--accent);
    border-radius: 2px;
  }

  .meta-date {
    font-family: 'Caveat', cursive;
    font-size: 1.15rem;
    color: var(--textMuted);
  }

  .meta-theme {
    font-family: 'Space Mono', monospace;
    font-size: 0.6rem;
    letter-spacing: 0.1em;
    text-transform: uppercase;
    color: var(--accent);
    opacity: 0.5;
    margin-left: auto;
  }

  .hero-route-line {
    font-family: 'Playfair Display', serif;
    font-size: clamp(1.6rem, 5vw, 2.8rem);
    font-weight: 700;
    line-height: 1.1;
    margin-bottom: 0.5rem;
    display: flex;
    align-items: center;
    flex-wrap: wrap;
    gap: 0.5rem 0.75rem;
  }

  .route-from { opacity: 0.7; }
  .route-arrow {
    font-size: 0.7em;
    color: var(--accent);
    opacity: 0.6;
  }
  .route-to { color: var(--accent); }

  .hero-tagline {
    font-family: 'Caveat', cursive;
    font-size: clamp(1.05rem, 2.5vw, 1.35rem);
    color: var(--textMuted);
    font-style: italic;
    margin-bottom: 1.5rem;
  }

  /* â”€â”€â”€ STATS BAR â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .stats-bar {
    display: flex;
    align-items: center;
    gap: clamp(1rem, 3vw, 2.5rem);
    padding: 1rem clamp(1.25rem, 5vw, 3rem);
    background: var(--surface);
    border-bottom: 1px solid var(--border);
    overflow-x: auto;
    scrollbar-width: none;
    flex-wrap: wrap;
  }

  .stats-bar::-webkit-scrollbar { display: none; }

  .stat-item {
    display: flex;
    align-items: baseline;
    gap: 0.4rem;
    white-space: nowrap;
    flex-shrink: 0;
  }

  .stat-val {
    font-family: 'Space Mono', monospace;
    font-size: 1.1rem;
    font-weight: 700;
    color: var(--accent);
  }

  .stat-lbl {
    font-size: 0.65rem;
    letter-spacing: 0.12em;
    text-transform: uppercase;
    color: var(--textMuted);
  }

  .stat-divider {
    width: 1px;
    height: 24px;
    background: var(--border);
    flex-shrink: 0;
  }

  .stat-gallery-link {
    text-decoration: none;
    transition: opacity 0.2s;
  }
  .stat-gallery-link:hover { opacity: 0.7; }
  .stat-gallery-link .stat-lbl {
    display: flex;
    align-items: center;
    gap: 0.25rem;
  }
  .stat-gallery-link .stat-lbl svg {
    width: 11px;
    height: 11px;
    opacity: 0.7;
  }

  .stat-map-link {
    text-decoration: none;
    transition: opacity 0.2s;
  }
  .stat-map-link:hover { opacity: 0.7; }
  .stat-map-link .stat-lbl {
    display: flex;
    align-items: center;
    gap: 0.25rem;
  }
  .stat-map-link .stat-lbl svg {
    width: 11px;
    height: 11px;
    opacity: 0.7;
  }

  /* â”€â”€â”€ MAIN CONTENT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .day-content {
    max-width: 760px;
    margin: 0 auto;
    padding: clamp(2rem, 5vw, 3.5rem) clamp(1.25rem, 5vw, 2.5rem);
  }

  /* â”€â”€â”€ NARRATIVE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .narrative-block {
    margin-bottom: 2.5rem;
  }

  .narrative-block p {
    font-size: clamp(0.95rem, 2vw, 1.05rem);
    line-height: 1.8;
    color: var(--text);
    margin-bottom: 1.1rem;
  }

  .narrative-block p:last-child { margin-bottom: 0; }

  /* â”€â”€â”€ HIGHLIGHTS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .section-label {
    font-family: 'Space Mono', monospace;
    font-size: 0.65rem;
    letter-spacing: 0.2em;
    text-transform: uppercase;
    color: var(--accent);
    margin-bottom: 1rem;
    display: flex;
    align-items: center;
    gap: 0.6rem;
  }

  .section-label::after {
    content: '';
    flex: 1;
    height: 1px;
    background: var(--border);
  }

  .highlights-list {
    list-style: none;
    margin-bottom: 2.5rem;
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));
    gap: 0.5rem;
  }

  .highlights-list li {
    padding: 0.6rem 0.85rem;
    background: var(--surface);
    border: 1px solid var(--border);
    border-left: 3px solid var(--accent);
    border-radius: 2px;
    font-size: 0.875rem;
    line-height: 1.4;
    color: var(--text);
  }

  /* â”€â”€â”€ STOPS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .stops-list {
    list-style: none;
    margin-bottom: 2.5rem;
  }

  .stop-item {
    display: flex;
    gap: 1rem;
    padding: 0.75rem 0;
    border-bottom: 1px dashed var(--border);
  }

  .stop-item:last-child { border-bottom: none; }

  .stop-marker {
    width: 8px;
    height: 8px;
    border-radius: 50%;
    background: var(--accent);
    flex-shrink: 0;
    margin-top: 6px;
    box-shadow: 0 0 8px var(--accent);
  }

  .stop-info h4 {
    font-family: 'Raleway', sans-serif;
    font-weight: 600;
    font-size: 0.9rem;
    color: var(--text);
    margin-bottom: 0.15rem;
  }

  .stop-info p {
    font-size: 0.8rem;
    color: var(--textMuted);
    font-family: 'Caveat', cursive;
    font-size: 0.95rem;
  }

  /* â”€â”€â”€ MEALS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .meals-grid {
    display: flex;
    flex-direction: column;
    gap: 0.6rem;
    margin-bottom: 2.5rem;
  }

  .meal-card {
    display: flex;
    gap: 1rem;
    align-items: flex-start;
    padding: 0.85rem 1rem;
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 2px;
  }

  .meal-type {
    font-family: 'Space Mono', monospace;
    font-size: 0.6rem;
    letter-spacing: 0.12em;
    text-transform: uppercase;
    color: var(--accent);
    padding: 0.2em 0.5em;
    border: 1px solid var(--border);
    border-radius: 2px;
    white-space: nowrap;
    flex-shrink: 0;
    margin-top: 1px;
  }

  .meal-info {
    flex: 1;
  }

  .meal-place {
    font-weight: 600;
    font-size: 0.9rem;
    color: var(--text);
    display: block;
    margin-bottom: 0.1rem;
  }

  .meal-note {
    font-family: 'Caveat', cursive;
    font-size: 0.95rem;
    color: var(--textMuted);
  }

  /* â”€â”€â”€ ACCOMMODATION â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  /* â”€â”€â”€ MUSIC â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .music-section {
    margin-bottom: 2.5rem;
  }

  .music-card {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 2px;
    overflow: hidden;
  }

  .music-meta {
    display: flex;
    align-items: baseline;
    gap: 0.75rem;
    padding: 0.85rem 1rem 0.75rem;
    flex-wrap: wrap;
  }

  .music-artist {
    font-family: 'Raleway', sans-serif;
    font-weight: 600;
    font-size: 0.9rem;
    color: var(--accent);
  }

  .music-note {
    font-family: 'Caveat', cursive;
    font-size: 0.95rem;
    color: var(--textMuted);
  }

  .music-embed {
    padding: 0 0 0;
    line-height: 0;
  }

  .music-embed iframe {
    display: block;
    border-radius: 0 !important;
  }

  /* â”€â”€â”€ STAY â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .stay-card {
    display: flex;
    gap: 1rem;
    align-items: center;
    padding: 1rem 1.25rem;
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 2px;
    margin-bottom: 2.5rem;
  }

  .stay-icon {
    font-size: 1.5rem;
    flex-shrink: 0;
  }

  .stay-info label {
    font-family: 'Space Mono', monospace;
    font-size: 0.6rem;
    letter-spacing: 0.15em;
    text-transform: uppercase;
    color: var(--accent);
    display: block;
    margin-bottom: 0.2rem;
  }

  .stay-info span {
    font-size: 0.9rem;
    color: var(--text);
    font-weight: 500;
  }

  /* â”€â”€â”€ HERO MAP â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  #day-hero-map {
    position: absolute;
    inset: 0;
    z-index: 1;
  }

  /* Hide leaflet controls in the hero map */
  .day-hero :global(.leaflet-control-zoom),
  .day-hero :global(.leaflet-control-attribution) {
    display: none;
  }

  /* â”€â”€â”€ DAY NAV PREV/NEXT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .day-inline-nav {
    display: flex;
    gap: 1rem;
    margin: 2rem 0;
    padding-top: 1.5rem;
    border-top: 1px dashed var(--border);
  }

  .inline-nav-link {
    flex: 1;
    padding: 1rem;
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 2px;
    display: flex;
    flex-direction: column;
    gap: 0.3rem;
    transition: border-color 0.2s, background 0.2s;
  }

  .inline-nav-link:hover {
    border-color: var(--accent);
    background: color-mix(in srgb, var(--surface) 90%, var(--accent));
  }

  .inline-nav-link.next { text-align: right; }

  .inline-nav-dir {
    font-family: 'Space Mono', monospace;
    font-size: 0.6rem;
    letter-spacing: 0.12em;
    text-transform: uppercase;
    color: var(--accent);
  }

  .inline-nav-title {
    font-size: 0.85rem;
    font-weight: 600;
    color: var(--text);
  }

  .inline-nav-date {
    font-family: 'Caveat', cursive;
    font-size: 0.9rem;
    color: var(--textMuted);
  }

  /* â”€â”€â”€ MOBILE FOOTER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .mobile-footer {
    display: none;
  }

  @media (max-width: 768px) {
    .mobile-footer {
      display: block;
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      z-index: 100;
      background: color-mix(in srgb, var(--bgDeep, #060f1a) 92%, transparent);
      backdrop-filter: blur(16px) saturate(1.4);
      -webkit-backdrop-filter: blur(16px) saturate(1.4);
      border-top: 1px solid var(--border, rgba(255,255,255,0.08));
    }

    body {
      padding-bottom: calc(64px + 24px);
    }

    .mobile-footer-nav {
      display: flex;
      align-items: stretch;
      height: 64px;
    }

    .mobile-footer-link {
      flex: 1;
      display: flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0 1rem;
      color: var(--textMuted, #8ab4cc);
      text-decoration: none;
      transition: background 0.15s, color 0.15s;
      min-width: 0;
    }

    .mobile-footer-link:active {
      background: rgba(255,255,255,0.05);
      color: var(--accent, #7ebcd6);
    }

    .mobile-footer-link svg {
      flex-shrink: 0;
      width: 18px;
      height: 18px;
      opacity: 0.6;
    }

    .mobile-footer-link.next {
      justify-content: flex-end;
      text-align: right;
    }

    .mobile-footer-link-inner {
      display: flex;
      flex-direction: column;
      gap: 2px;
      min-width: 0;
    }

    .mobile-footer-dir {
      font-family: 'Space Mono', monospace;
      font-size: 0.6rem;
      letter-spacing: 0.1em;
      text-transform: uppercase;
      color: var(--accent, #7ebcd6);
    }

    .mobile-footer-cities {
      font-size: 0.7rem;
      font-family: 'Raleway', sans-serif;
      font-weight: 500;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .mobile-footer-home {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 3px;
      padding: 0 1.25rem;
      color: var(--textMuted, #8ab4cc);
      text-decoration: none;
      border-left: 1px solid var(--border, rgba(255,255,255,0.08));
      border-right: 1px solid var(--border, rgba(255,255,255,0.08));
      flex-shrink: 0;
      transition: background 0.15s, color 0.15s;
    }

    .mobile-footer-home:active {
      background: rgba(255,255,255,0.05);
      color: var(--accent, #7ebcd6);
    }

    .mobile-footer-home span {
      font-family: 'Space Mono', monospace;
      font-size: 0.5rem;
      letter-spacing: 0.1em;
      text-transform: uppercase;
      opacity: 0.6;
    }
  }
</style>

<!-- â”€â”€â”€ HERO â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
<header class="day-hero">
  <!-- Gradient always renders first â€” shows while map tiles load -->
  <div class="hero-bg-grad" aria-hidden="true"></div>

  {day.gpxUrl
    ? <div id="day-hero-map" data-gpx={day.gpxUrl} data-day={day.day} data-labels={JSON.stringify(day.mapLabels ?? [])} aria-hidden="true"></div>
    : <div class="hero-texture" aria-hidden="true"></div>
  }

  <div class="hero-scrim" aria-hidden="true"></div>

  <div class="hero-content">
    <a href="/" class="back-link">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <polyline points="15,18 9,12 15,6"/>
      </svg>
      All Days
    </a>

    <div class="hero-meta">
      <span class="meta-day">Day {day.day}</span>
      <span class="meta-date">{day.dayOfWeek}, {day.date}</span>
      <span class="meta-theme">{theme.name}</span>
    </div>

    <div class="hero-route-line">
      <span class="route-from">{day.from}</span>
      <span class="route-arrow">â†’</span>
      <span class="route-to">{day.to}</span>
    </div>

    <p class="hero-tagline">{day.tagline}</p>
  </div>
</header>

<!-- â”€â”€â”€ STATS BAR â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
<div class="stats-bar" role="region" aria-label="Day statistics">
  <div class="stat-item">
    <span class="stat-val">{day.miles}</span>
    <span class="stat-lbl">miles</span>
  </div>
  <div class="stat-divider" aria-hidden="true"></div>
  <div class="stat-item">
    <span class="stat-val">{day.duration}</span>
    <span class="stat-lbl">driving</span>
  </div>
  <div class="stat-divider" aria-hidden="true"></div>
  <div class="stat-item">
    <span class="stat-val" style="font-size:0.75rem;">{day.from} â†’ {day.to}</span>
  </div>
  {day.galleryImages.length > 0 && (
    <>
      <div class="stat-divider" aria-hidden="true"></div>
      <a href="#gallery" class="stat-item stat-gallery-link" aria-label={`Jump to gallery â€” ${day.galleryImages.length} items`}>
        <span class="stat-val">{day.galleryImages.length}</span>
        <span class="stat-lbl">
          {day.galleryImages.filter(i => i.video).length > 0 ? 'photos & video' : 'photos'}
          <svg viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="1.5" aria-hidden="true"><polyline points="8,3 8,13"/><polyline points="4,9 8,13 12,9"/></svg>
        </span>
      </a>
    </>
  )}
  {day.gpxUrl && (
    <>
      <div class="stat-divider" aria-hidden="true"></div>
      <a href={`/mapbook?day=${day.day}`} class="stat-item stat-map-link" aria-label="View route map">
        <span class="stat-val">
          <svg viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="1.5" aria-hidden="true" style="width:1rem;height:1rem;vertical-align:middle;"><path d="M8 2C5.8 2 4 3.8 4 6c0 3 4 8 4 8s4-5 4-8c0-2.2-1.8-4-4-4z"/><circle cx="8" cy="6" r="1.2" fill="currentColor" stroke="none"/></svg>
        </span>
        <span class="stat-lbl">
          route
          <svg viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="1.5" aria-hidden="true"><polyline points="4,8 12,8"/><polyline points="9,5 12,8 9,11"/></svg>
        </span>
      </a>
    </>
  )}
</div>

<!-- â”€â”€â”€ MAIN CONTENT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
<main>
  <div class="day-content">

    <!-- Narrative -->
    {day.narrative.length > 0 && (
      <section class="narrative-block animate-fade-up">
        {day.narrative.map(p => <p>{p}</p>)}
      </section>
    )}

    <!-- Highlights -->
    {day.highlights.length > 0 && (
      <section>
        <p class="section-label">Highlights</p>
        <ul class="highlights-list stagger">
          {day.highlights.map(h => <li>{h}</li>)}
        </ul>
      </section>
    )}

    <!-- Accommodation -->
    <section>
      <p class="section-label">Stay</p>
      <div class="stay-card">
        <span class="stay-icon" aria-hidden="true">ğŸ›</span>
        <div class="stay-info">
          <label>Night {day.day}</label>
          <span>{day.accommodation}</span>
        </div>
      </div>
    </section>

    <!-- Music embed -->
    {day.music && (
      <section class="music-section">
        <p class="section-label">Music</p>
        <div class="music-card">
          <div class="music-meta">
            <span class="music-artist">{day.music.artist}</span>
            {day.music.note && <span class="music-note">{day.music.note}</span>}
          </div>
          <div class="music-embed">
            <iframe
              src={day.music.spotifyEmbed}
              width="100%"
              height="152"
              frameborder="0"
              allowfullscreen
              allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture"
              loading="lazy"
              style="border-radius: 8px;"
              title={`${day.music.artist} on Spotify`}
            ></iframe>
          </div>
        </div>
      </section>
    )}

    <!-- Gallery -->
    <Gallery images={day.galleryImages} dayNum={day.day} />

    <!-- Inline prev/next nav -->
    <nav class="day-inline-nav" aria-label="Previous and next day">
      {prevDay ? (
        <a href={`/days/${prevDay.slug}`} class="inline-nav-link prev">
          <span class="inline-nav-dir">â† Day {prevDay.day}</span>
          <span class="inline-nav-title">{prevDay.fromShort} â†’ {prevDay.toShort}</span>
          <span class="inline-nav-date">{prevDay.date}</span>
        </a>
      ) : (
        <div class="inline-nav-link prev" style="opacity:0.3;">
          <span class="inline-nav-dir">â† Start</span>
          <span class="inline-nav-title">Philadelphia, PA</span>
          <span class="inline-nav-date">The beginning</span>
        </div>
      )}

      {nextDay ? (
        <a href={`/days/${nextDay.slug}`} class="inline-nav-link next">
          <span class="inline-nav-dir">Day {nextDay.day} â†’</span>
          <span class="inline-nav-title">{nextDay.fromShort} â†’ {nextDay.toShort}</span>
          <span class="inline-nav-date">{nextDay.date}</span>
        </a>
      ) : (
        <div class="inline-nav-link next" style="opacity:0.3; text-align:right;">
          <span class="inline-nav-dir">End â†’</span>
          <span class="inline-nav-title">California</span>
          <span class="inline-nav-date">Home.</span>
        </div>
      )}
    </nav>

  </div>
</main>

<!-- â”€â”€â”€ FILMSTRIP NAV â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
<DayNav currentDay={day.day} />

<!-- â”€â”€â”€ MOBILE FOOTER (shown on mobile, hidden on desktop) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
<footer class="mobile-footer">
  <div class="mobile-footer-nav">
    {prevDay ? (
      <a href={`/days/${prevDay.slug}`} class="mobile-footer-link prev">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true"><polyline points="15,18 9,12 15,6"/></svg>
        <span class="mobile-footer-link-inner">
          <span class="mobile-footer-dir">Day {prevDay.day}</span>
          <span class="mobile-footer-cities">{prevDay.fromShort} â†’ {prevDay.toShort}</span>
        </span>
      </a>
    ) : (
      <div class="mobile-footer-link prev" style="opacity:0.3; pointer-events:none;">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true"><polyline points="15,18 9,12 15,6"/></svg>
        <span class="mobile-footer-link-inner">
          <span class="mobile-footer-dir">Start</span>
          <span class="mobile-footer-cities">Philadelphia</span>
        </span>
      </div>
    )}

    <a href="/" class="mobile-footer-home" aria-label="All days">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true" width="18" height="18"><circle cx="12" cy="12" r="9"/><line x1="12" y1="8" x2="12" y2="16"/><line x1="8" y1="12" x2="16" y2="12"/></svg>
      <span>All Days</span>
    </a>

    {nextDay ? (
      <a href={`/days/${nextDay.slug}`} class="mobile-footer-link next">
        <span class="mobile-footer-link-inner">
          <span class="mobile-footer-dir">Day {nextDay.day}</span>
          <span class="mobile-footer-cities">{nextDay.fromShort} â†’ {nextDay.toShort}</span>
        </span>
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true"><polyline points="9,18 15,12 9,6"/></svg>
      </a>
    ) : (
      <div class="mobile-footer-link next" style="opacity:0.3; pointer-events:none;">
        <span class="mobile-footer-link-inner">
          <span class="mobile-footer-dir">End</span>
          <span class="mobile-footer-cities">California</span>
        </span>
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true"><polyline points="9,18 15,12 9,6"/></svg>
      </div>
    )}
  </div>
</footer>

{day.gpxUrl && (
  <>
    <script is:inline src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script is:inline src="https://unpkg.com/leaflet-gpx@1.7.0/gpx.js"></script>
    <script is:inline>
    (function() {
      // Bold, dark colors chosen to pop on the light watercolor tile background
      var DAY_COLORS = {
        1:'#1a3a6e', 2:'#6e1a2a', 3:'#1e5e2e', 4:'#6e3a1a', 5:'#4a1a6e',
        6:'#8e1a1a', 7:'#1a5e5e', 8:'#5e4a0a', 9:'#1a4a2e',
      };
      var el = document.getElementById('day-hero-map');
      if (!el) return;
      var gpxUrl = el.dataset.gpx;
      var dayNum = parseInt(el.dataset.day);
      var color = DAY_COLORS[dayNum] || '#c8a84a';

      var heroMap = L.map(el, {
        dragging: false, zoomControl: false, scrollWheelZoom: false,
        touchZoom: false, doubleClickZoom: false, boxZoom: false,
        keyboard: false, tap: false, attributionControl: false,
      });

      L.tileLayer('https://tiles.stadiamaps.com/tiles/stamen_watercolor/{z}/{x}/{y}.jpg', {
        maxZoom: 16,
      }).addTo(heroMap);

      L.tileLayer('https://tiles.stadiamaps.com/tiles/stamen_toner_labels/{z}/{x}/{y}{r}.png', {
        maxZoom: 20,
        opacity: 0.6,
      }).addTo(heroMap);

      heroMap.setView([36.5, -95], 4);

      var layer = new L.GPX(gpxUrl, {
        async: true,
        marker_options: { startIconUrl: null, endIconUrl: null, shadowUrl: null, wptIconUrls: { '': null } },
        polyline_options: { color: color, weight: 4, opacity: 1, lineCap: 'round', lineJoin: 'round' },
      });
      var customLabels = [];
      try { customLabels = JSON.parse(el.dataset.labels || '[]'); } catch(e) {}

      layer.on('loaded', function(e) {
        var bounds = e.target.getBounds();
        customLabels.forEach(function(lbl) { bounds.extend([lbl.lat, lbl.lng]); });
        heroMap.fitBounds(bounds, { padding: [80, 80], animate: false });
        customLabels.forEach(function(lbl) {
          var icon = L.divIcon({
            className: '',
            html: '<div style="'
              + 'background:rgba(255,255,255,0.82);'
              + 'color:#111;'
              + 'font-family:\'Space Mono\',monospace;'
              + 'font-size:9px;'
              + 'font-weight:700;'
              + 'letter-spacing:0.07em;'
              + 'text-transform:uppercase;'
              + 'padding:3px 7px;'
              + 'border-radius:2px;'
              + 'border:1px solid rgba(0,0,0,0.25);'
              + 'white-space:nowrap;'
              + 'pointer-events:none;'
              + 'transform:translate(-50%,-50%);'
              + '">' + lbl.text + '</div>',
            iconSize: [0, 0],
            iconAnchor: [0, 0],
          });
          L.marker([lbl.lat, lbl.lng], { icon: icon, interactive: false }).addTo(heroMap);
        });
      });
      layer.addTo(heroMap);
    })();
    </script>
  </>
)}

</Base>
